/**
 * рЃбрЃћрЃАрЃбрЃў 4: рЃдрЃарЃЏрЃљ рЃљрЃќрЃарЃЮрЃЋрЃюрЃћрЃЉрЃљ
 * рЃбрЃћрЃАрЃбрЃљрЃЋрЃА рЃњрЃБрЃарЃБрЃџрЃЮрЃА рЃдрЃарЃЏрЃљ рЃљрЃќрЃарЃЮрЃЋрЃюрЃћрЃЉрЃўрЃА рЃерЃћрЃАрЃљрЃФрЃџрЃћрЃЉрЃџрЃЮрЃЉрЃљрЃА - рЃЎрЃЮрЃЏрЃърЃџрЃћрЃЦрЃАрЃБрЃарЃў рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃћрЃЉрЃўрЃА рЃњрЃљрЃЊрЃљрЃгрЃДрЃЋрЃћрЃбрЃљрЃА
 */

const axios = require('axios');

const AI_SERVICE_URL = 'http://localhost:8008';

const DEEP_THINKING_PROMPTS = [
  {
    prompt: "рЃЌрЃБ 5 рЃЏрЃљрЃюрЃЦрЃљрЃюрЃљ рЃљрЃгрЃљрЃарЃЏрЃЮрЃћрЃЉрЃА 5 рЃЊрЃћрЃбрЃљрЃџрЃА 5 рЃАрЃљрЃљрЃЌрЃерЃў, рЃарЃљрЃЏрЃЊрЃћрЃюрЃў рЃЊрЃћрЃбрЃљрЃџрЃў рЃљрЃгрЃљрЃарЃЏрЃЮрЃћрЃЉрЃА 100 рЃЏрЃљрЃюрЃЦрЃљрЃюрЃљрЃЏ 100 рЃАрЃљрЃљрЃЌрЃерЃў?",
    expectedAnswer: "10000",
    reasoningSteps: ["рЃърЃарЃЮрЃърЃЮрЃарЃфрЃўрЃБрЃџрЃЮрЃЉрЃўрЃА рЃњрЃљрЃЏрЃЮрЃЌрЃЋрЃџрЃљ", "рЃЏрЃљрЃюрЃЦрЃљрЃюрЃћрЃЉрЃўрЃА рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃўрЃА рЃњрЃљрЃќрЃарЃЊрЃљ", "рЃЊрЃарЃЮрЃўрЃА рЃњрЃљрЃќрЃарЃЊрЃљ"]
  },
  {
    prompt: "рЃарЃЮрЃЏрЃћрЃџрЃўрЃљ рЃБрЃцрЃарЃЮ рЃЏрЃФрЃўрЃЏрЃћ: 1 рЃЎрЃњ рЃЉрЃљрЃЏрЃЉрЃљ рЃЌрЃБ 1 рЃЎрЃњ рЃарЃЎрЃўрЃюрЃљ? рЃњрЃљрЃюрЃЏрЃљрЃарЃбрЃћ рЃарЃљрЃбрЃЮрЃЏ.",
    expectedAnswer: "рЃћрЃарЃЌрЃў рЃЊрЃљ рЃўрЃњрЃўрЃЋрЃћ рЃгрЃЮрЃюрЃљ",
    reasoningSteps: ["рЃгрЃЮрЃюрЃўрЃА рЃњрЃљрЃюрЃЏрЃљрЃарЃбрЃћрЃЉрЃљ", "рЃЏрЃљрЃАрЃўрЃА рЃЎрЃЮрЃюрЃфрЃћрЃцрЃфрЃўрЃљ", "рЃњрЃарЃљрЃЋрЃўрЃбрЃљрЃфрЃўрЃўрЃА рЃњрЃљрЃЋрЃџрЃћрЃюрЃљ"]
  },
  {
    prompt: "рЃЌрЃБ рЃЮрЃЌрЃљрЃ«рЃерЃў 12 рЃАрЃљрЃюрЃЌрЃћрЃџрЃўрЃљ рЃЊрЃљ рЃЌрЃўрЃЌрЃЮрЃћрЃБрЃџрЃў рЃљрЃюрЃЌрЃћрЃЉрЃА 3 рЃЮрЃЌрЃљрЃ«рЃА, рЃарЃљрЃЏрЃЊрЃћрЃюрЃў рЃЮрЃЌрЃљрЃ«рЃўрЃљ рЃњрЃљрЃюрЃљрЃЌрЃћрЃЉрЃБрЃџрЃў?",
    expectedAnswer: "12",
    reasoningSteps: ["рЃАрЃљрЃюрЃЌрЃџрЃћрЃЉрЃўрЃА рЃарЃљрЃЮрЃЊрЃћрЃюрЃЮрЃЉрЃљ", "рЃЌрЃўрЃЌрЃЮрЃћрЃБрЃџрЃў рЃАрЃљрЃюрЃЌрЃџрЃўрЃА рЃњрЃљрЃЋрЃџрЃћрЃюрЃљ", "рЃЮрЃарЃЏрЃ«рЃарЃўрЃЋрЃў рЃЎрЃљрЃЋрЃерЃўрЃарЃў"]
  },
  {
    prompt: "рЃњрЃљрЃљрЃЎрЃћрЃЌрЃћ рЃњрЃћрЃњрЃЏрЃљ рЃарЃЮрЃњрЃЮрЃа рЃерЃћрЃЋрЃЦрЃЏрЃюрЃљрЃЌ рЃЋрЃћрЃЉ рЃљрЃърЃџрЃўрЃЎрЃљрЃфрЃўрЃљ рЃЏрЃЮрЃЏрЃ«рЃЏрЃљрЃарЃћрЃЉрЃћрЃџрЃЌрЃљ рЃЏрЃљрЃарЃЌрЃЋрЃўрЃАрЃЌрЃЋрЃўрЃА. рЃЊрЃљрЃљрЃцрЃўрЃЦрЃАрЃўрЃарЃћ рЃюрЃљрЃЉрЃўрЃ»рЃћрЃЉрЃў.",
    expectedAnswer: "рЃбрЃћрЃЦрЃюрЃЮрЃџрЃЮрЃњрЃўрЃћрЃЉрЃўрЃА рЃљрЃарЃЕрЃћрЃЋрЃљ, рЃЊрЃўрЃќрЃљрЃўрЃюрЃў, рЃЊрЃћрЃЋрЃћрЃџрЃЮрЃърЃЏрЃћрЃюрЃбрЃў, рЃбрЃћрЃАрЃбрЃўрЃарЃћрЃЉрЃљ, рЃЊрЃћрЃърЃџрЃЮрЃўрЃЏрЃћрЃюрЃбрЃў",
    reasoningSteps: ["рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃћрЃЉрЃўрЃА рЃљрЃюрЃљрЃџрЃўрЃќрЃў", "рЃбрЃћрЃЦрЃюрЃЮрЃџрЃЮрЃњрЃўрЃћрЃЉрЃўрЃА рЃљрЃарЃЕрЃћрЃЋрЃљ", "рЃљрЃарЃЦрЃўрЃбрЃћрЃЦрЃбрЃБрЃарЃўрЃА рЃЊрЃљрЃњрЃћрЃњрЃЏрЃЋрЃљ", "рЃўрЃЏрЃърЃџрЃћрЃЏрЃћрЃюрЃбрЃљрЃфрЃўрЃљ"]
  },
  {
    prompt: "рЃарЃљрЃбрЃЮрЃЏ рЃљрЃарЃўрЃА рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃў рЃЎрЃЮрЃЊрЃўрЃА рЃЊрЃЮрЃЎрЃБрЃЏрЃћрЃюрЃбрЃљрЃфрЃўрЃљ? рЃЊрЃљрЃљрЃАрЃљрЃ«рЃћрЃџрЃћ 3 рЃЏрЃўрЃќрЃћрЃќрЃў.",
    expectedAnswer: "рЃ«рЃћрЃџрЃљрЃ«рЃџрЃљ рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃљ, рЃЏрЃ«рЃљрЃарЃЊрЃљрЃГрЃћрЃарЃљ, рЃњрЃБрЃюрЃЊрЃБрЃарЃў рЃЏрЃБрЃерЃљрЃЮрЃЉрЃљ",
    reasoningSteps: ["рЃ«рЃћрЃџрЃљрЃ«рЃџрЃљ рЃњрЃљрЃЏрЃЮрЃДрЃћрЃюрЃћрЃЉрЃўрЃА рЃАрЃўрЃЏрЃљрЃарЃбрЃўрЃЋрЃћ", "рЃЏрЃЮрЃЏрЃљрЃЋрЃљрЃџрЃў рЃЏрЃ«рЃљрЃарЃЊрЃљрЃГрЃћрЃарЃљ", "рЃњрЃБрЃюрЃЊрЃБрЃарЃў рЃћрЃцрЃћрЃЦрЃбрЃБрЃарЃЮрЃЉрЃљ"]
  }
];

async function testDeepThinking() {
  console.log('­ЪДа рЃЊрЃљрЃгрЃДрЃћрЃЉрЃљ: рЃдрЃарЃЏрЃљ рЃљрЃќрЃарЃЮрЃЋрЃюрЃћрЃЉрЃўрЃА рЃбрЃћрЃАрЃбрЃў\n');

  let totalTests = 0;
  let successfulReasoning = 0;

  for (const testPrompt of DEEP_THINKING_PROMPTS) {
    console.log(`­Ъњг рЃЎрЃўрЃЌрЃ«рЃЋрЃљ: "${testPrompt.prompt}"`);
    console.log(`­Ъј» рЃЏрЃЮрЃАрЃљрЃџрЃЮрЃЊрЃюрЃћрЃџрЃў рЃърЃљрЃАрЃБрЃ«рЃў: ${testPrompt.expectedAnswer}`);

    try {
      const startTime = Date.now();

      const response = await axios.post(`${AI_SERVICE_URL}/api/ai/chat`, {
        message: testPrompt.prompt,
        userId: 'deep_thinking_test_user'
      });

      const endTime = Date.now();
      const responseTime = endTime - startTime;

      console.log(`РюЁ рЃърЃљрЃАрЃБрЃ«рЃў рЃЏрЃўрЃдрЃћрЃЉрЃБрЃџрЃўрЃљ ${responseTime}ms-рЃерЃў`);
      console.log(`­ЪЊЮ рЃърЃљрЃАрЃБрЃ«рЃў: ${response.data.response.substring(0, 300)}...`);

      if (response.data.success) {
        totalTests++;

        // рЃдрЃарЃЏрЃљ рЃљрЃќрЃарЃЮрЃЋрЃюрЃћрЃЉрЃўрЃА рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃљ
        const responseText = response.data.response.toLowerCase();

        let reasoningScore = 0;

        // рЃерЃћрЃљрЃЏрЃЮрЃгрЃЏрЃћ рЃАрЃгрЃЮрЃарЃў рЃърЃљрЃАрЃБрЃ«рЃў
        if (responseText.includes(testPrompt.expectedAnswer.toLowerCase())) {
          reasoningScore += 2;
        }

        // рЃерЃћрЃљрЃЏрЃЮрЃгрЃЏрЃћ рЃљрЃќрЃарЃЮрЃЋрЃюрЃћрЃЉрЃўрЃА рЃюрЃљрЃЉрЃўрЃ»рЃћрЃЉрЃў
        testPrompt.reasoningSteps.forEach(step => {
          if (responseText.includes(step.toLowerCase())) {
            reasoningScore += 1;
          }
        });

        // рЃерЃћрЃљрЃЏрЃЮрЃгрЃЏрЃћ рЃЊрЃћрЃбрЃљрЃџрЃБрЃарЃў рЃњрЃљрЃюрЃЏрЃљрЃарЃбрЃћрЃЉрЃљ
        const hasExplanation = responseText.includes('рЃарЃљрЃбрЃЮрЃЏ') ||
                              responseText.includes('рЃњрЃљрЃюрЃЏрЃљрЃарЃбрЃћрЃЉрЃљ') ||
                              responseText.includes('рЃерЃћрЃЊрЃћрЃњрЃў') ||
                              responseText.includes('рЃљрЃюрЃљрЃџрЃўрЃќрЃў') ||
                              responseText.includes('рЃњрЃљрЃљрЃюрЃљрЃџрЃўрЃќрЃћ');

        if (hasExplanation) {
          reasoningScore += 1;
        }

        const maxScore = 2 + testPrompt.reasoningSteps.length + 1;
        const scorePercentage = (reasoningScore / maxScore * 100).toFixed(1);

        console.log(`­ЪДа рЃљрЃќрЃарЃЮрЃЋрЃюрЃћрЃЉрЃўрЃА рЃЦрЃБрЃџрЃљ: ${reasoningScore}/${maxScore} (${scorePercentage}%)`);

        if (scorePercentage >= 60) {
          successfulReasoning++;
          console.log(`РюЁ рЃЎрЃљрЃарЃњрЃў рЃдрЃарЃЏрЃљ рЃљрЃќрЃарЃЮрЃЋрЃюрЃћрЃЉрЃљ`);
        } else {
          console.log(`РЮї рЃАрЃљрЃГрЃўрЃарЃЮрЃљ рЃњрЃљрЃБрЃЏрЃ»рЃЮрЃЉрЃћрЃАрЃћрЃЉрЃљ`);
        }

      } else {
        console.log(`РЮї рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљ рЃЕрЃљрЃЋрЃљрЃарЃЊрЃљ: ${response.data.error || 'рЃБрЃфрЃюрЃЮрЃЉрЃў рЃерЃћрЃфрЃЊрЃЮрЃЏрЃљ'}`);
      }

    } catch (error) {
      console.error(`РЮї рЃбрЃћрЃАрЃбрЃў рЃЕрЃљрЃЋрЃљрЃарЃЊрЃљ: ${error.message}`);
    }

    console.log('Рћђ'.repeat(80) + '\n');

    // рЃЊрЃљрЃДрЃЮрЃЋрЃюрЃћрЃЉрЃљ рЃбрЃћрЃАрЃбрЃћрЃЉрЃА рЃерЃЮрЃарЃўрЃА
    await new Promise(resolve => setTimeout(resolve, 2000));
  }

  // рЃерЃћрЃЊрЃћрЃњрЃћрЃЉрЃўрЃА рЃерЃћрЃ»рЃљрЃЏрЃћрЃЉрЃљ
  const successRate = totalTests > 0 ? (successfulReasoning / totalTests * 100).toFixed(1) : 0;

  console.log('­ЪЊі рЃдрЃарЃЏрЃљ рЃљрЃќрЃарЃЮрЃЋрЃюрЃћрЃЉрЃўрЃА рЃбрЃћрЃАрЃбрЃў рЃЊрЃљрЃАрЃарЃБрЃџрЃћрЃЉрЃБрЃџрЃўрЃљ.');
  console.log(`­ЪЊѕ рЃАрЃБрЃџ рЃбрЃћрЃАрЃбрЃћрЃЉрЃў: ${totalTests}`);
  console.log(`­ЪДа рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃБрЃџрЃў рЃљрЃќрЃарЃЮрЃЋрЃюрЃћрЃЉрЃљ: ${successfulReasoning}`);
  console.log(`РюЁ рЃгрЃљрЃарЃЏрЃљрЃбрЃћрЃЉрЃўрЃА рЃЏрЃљрЃЕрЃЋрЃћрЃюрЃћрЃЉрЃћрЃџрЃў: ${successRate}%`);

  if (successRate >= 80) {
    console.log('­ЪјЅ рЃдрЃарЃЏрЃљ рЃљрЃќрЃарЃЮрЃЋрЃюрЃћрЃЉрЃљ рЃФрЃљрЃџрЃўрЃљрЃю рЃЎрЃљрЃарЃњ рЃЊрЃЮрЃюрЃћрЃќрЃћрЃљ!');
  } else if (successRate >= 60) {
    console.log('­ЪЉЇ рЃдрЃарЃЏрЃљ рЃљрЃќрЃарЃЮрЃЋрЃюрЃћрЃЉрЃљ рЃАрЃљрЃерЃБрЃљрЃџрЃЮ рЃЊрЃЮрЃюрЃћрЃќрЃћрЃљ.');
  } else {
    console.log('Рџа№ИЈ рЃАрЃљрЃГрЃўрЃарЃЮрЃљ рЃдрЃарЃЏрЃљ рЃљрЃќрЃарЃЮрЃЋрЃюрЃћрЃЉрЃўрЃА рЃњрЃљрЃБрЃЏрЃ»рЃЮрЃЉрЃћрЃАрЃћрЃЉрЃљ!');
  }
}

// рЃњрЃљрЃБрЃерЃЋрЃў рЃбрЃћрЃАрЃбрЃў
if (require.main === module) {
  testDeepThinking().catch(console.error);
}

module.exports = { testDeepThinking };
